#!/usr/bin/env bash
set -e

wm="sway"
#wm="startx"
wm_args=

[[ "$1" ]] && wm="$1"

# confirm window manager exists
which "$wm" >/dev/null 2>/dev/null
if [ $? -ne 0 ]; then
    echo "error: provided window manager not found: $wm"
    exit 1
fi

## config {{{
# input
export XKB_DEFAULT_OPTIONS=caps:swapescape,compose:menu

# IBus
export GTK_IM_MODULE=ibus
export XMODIFIERS=@im=ibus
export QT_IM_MODULE=ibus
ibus-daemon -drx

# 2019-11-20: fix ibus-mozc by starting manually? looks like IBus can't start it
# properly... weird
/usr/lib/ibus-mozc/ibus-engine-mozc &

# notifications
mako &
## }}}

# 2020-03-13: TODO: make a shell file that only gets included if wayland
export MOZ_ENABLE_WAYLAND=1

"$wm" $wm_args
