# vim: ft=sh
#
# Non-specific/common (bash & zsh) shell configuration.
#

# safely get all available XDG directories & set config directory from now on
# straight from freedesktop.org @ https://www.freedesktop.org/wiki/Software/xdg-user-dirs/
test -f "${XDG_CONFIG_HOME:-$HOME/.config}/user-dirs.dirs" \
    && source "${XDG_CONFIG_HOME:-$HOME/.config}/user-dirs.dirs"
cfg_dir="${XDG_CONFIG_HOME:-$HOME/.config}/shell"

for f in "$cfg_dir"/general.d/*; do source "$f"; done

## $PATH prefixes {{{
_prefix_path_if_present() {
    [[ -d "$1" ]] && export PATH="$1:$PATH"
}

# ~/bin
# sometimes added, but let's make sure it's leftmost
_prefix_path_if_present "$HOME/bin"

# rbenv
_prefix_path_if_present "$HOME/.rbenv/bin"

# snap
# 2019-02-13: disabled because not preferred
#_prefix_path_if_present "/snap/bin"

unset _prefix_path_if_present
## $PATH prefixes }}}

# gpg-agent (+handle SSH)
export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)

# turn off all console system bells (PC speaker beeps) - does not affect X
if [[ "$TERM" == "linux" ]]; then
    setterm --blength 0
fi

## Programming languages {{{
# Ruby: initialise rbenv if present
if command -v rbenv >/dev/null 2>&1; then
    eval "$(rbenv init -)"
fi

# Java: make sure we use anti-aliasing
export _JAVA_OPTIONS="-Dawt.useSystemAAFontSettings=on -Dswing.aatext=true"

# Java: Arch doesn't set its own classpath or something? smh
export CLASSPATH=".:/usr/share/java/*"

# Python: set a directory for personal user modules
export PYTHONPATH="$HOME/.local/share/python-user"
## }}}

## Colors via envvars {{{
if [[ -r "$SHCFG_DIR/dircolors" ]]; then
    # `dircolors` prints out `LS_COLORS='...'; export LS_COLORS`, so eval-ing
    # $(dircolors) effectively sets the LS_COLORS environment variable.
    # thanks [Matt](http://unix.stackexchange.com/a/94306)
    eval $(dircolors "$SHCFG_DIR/dircolors")
fi

# man: use nice colours (via exporting termcap values for less)
export LESS_TERMCAP_mb=$'\e[01;31m'
export LESS_TERMCAP_md=$'\e[01;31m'
export LESS_TERMCAP_me=$'\e[0m'
export LESS_TERMCAP_se=$'\e[0m'
export LESS_TERMCAP_so=$'\e[01;44;33m'
export LESS_TERMCAP_ue=$'\e[0m'
export LESS_TERMCAP_us=$'\e[01;32m'
## }}}

## Common programs via envvars {{{
# Vim master race
export EDITOR="vim"

# Set general file opener (e.g. xdg-open)
export FILE_OPENER="mimeo"
## }}}

# shell-specific options
[[ -n "$BASH_VERSION" ]]  && source "$cfg_dir"/bashrc
[[ -n "$ZSH_VERSION" ]]   && source "$cfg_dir"/zshrc

unset cfg_dir
